"use strict";(self.webpackChunktutorial_of_ai_kit=self.webpackChunktutorial_of_ai_kit||[]).push([[242],{7885:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var t=i(5893),a=i(1151);const s={},r=void 0,l={id:"Chapter_6-RaspberryPi_and_AIoT/Frigate_NVR_and_Home_Assistant_Intergration_Wiki",title:"Frigate_NVR_and_Home_Assistant_Intergration_Wiki",description:"---",source:"@site/../articles/Chapter_6-RaspberryPi_and_AIoT/Frigate_NVR_and_Home_Assistant_Intergration_Wiki.md",sourceDirName:"Chapter_6-RaspberryPi_and_AIoT",slug:"/Chapter_6-RaspberryPi_and_AIoT/Frigate_NVR_and_Home_Assistant_Intergration_Wiki",permalink:"/Tutorial-of-AI-Kit-with-Raspberry-Pi-From-Zero-to-Hero/docs/Chapter_6-RaspberryPi_and_AIoT/Frigate_NVR_and_Home_Assistant_Intergration_Wiki",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Hailo-Powered Car Park Management with ThingsBoard",permalink:"/Tutorial-of-AI-Kit-with-Raspberry-Pi-From-Zero-to-Hero/docs/Chapter_6-RaspberryPi_and_AIoT/Car_Park_Solution_Management_with_Thingsboard"}},o={},d=[{value:"sidebar_position: 5",id:"sidebar_position-5",level:2},{value:"\ud83c\udf0d Introduction",id:"-introduction",level:2},{value:"\ud83d\udee0\ufe0f Install Hailo PCIe Driver",id:"\ufe0f-install-hailo-pcie-driver",level:2},{value:"Step 1: Enable PCIe Gen 3 Mode",id:"step-1-enable-pcie-gen-3-mode",level:3},{value:"Step 2: Install PCIe Driver",id:"step-2-install-pcie-driver",level:3},{value:"Step 3: Install Firmware",id:"step-3-install-firmware",level:3},{value:"Step 4: Fix PCIe Descriptor Size Issue",id:"step-4-fix-pcie-descriptor-size-issue",level:3},{value:"Step 5: Reboot and Verify",id:"step-5-reboot-and-verify",level:3},{value:"\ud83d\udea7 Install Frigate NVR with Docker",id:"-install-frigate-nvr-with-docker",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Update System",id:"update-system",level:3},{value:"Install Docker",id:"install-docker",level:3},{value:"Pull Frigate Image",id:"pull-frigate-image",level:3},{value:"Create Directory Structure",id:"create-directory-structure",level:3},{value:"Create Docker Compose File (frigate.yml)",id:"create-docker-compose-file-frigateyml",level:3},{value:"Create Frigate Config File (config/config.yml)",id:"create-frigate-config-file-configconfigyml",level:3},{value:"Start Frigate",id:"start-frigate",level:3},{value:"Access Web UI",id:"access-web-ui",level:3},{value:"\ud83c\udf1f Home Assistant Integration",id:"-home-assistant-integration",level:2},{value:"Step 1: HACS Setup",id:"step-1-hacs-setup",level:3},{value:"Step 2: Install MQTT Add-on",id:"step-2-install-mqtt-add-on",level:3},{value:"Step 3: Update Frigate Config for MQTT",id:"step-3-update-frigate-config-for-mqtt",level:3},{value:"Step 3: Update Frigate Config for MQTT",id:"step-3-update-frigate-config-for-mqtt-1",level:3},{value:"Step 4: Restart Frigate",id:"step-4-restart-frigate",level:3},{value:"Step 5: Confirm MQTT is Working (optional)",id:"step-5-confirm-mqtt-is-working-optional",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"sidebar_position-5",children:"sidebar_position: 5"}),"\n",(0,t.jsx)(n.h1,{id:"frigate-nvr-and-home-assistant-integration-wiki",children:"Frigate NVR and Home Assistant Integration Wiki"}),"\n",(0,t.jsx)(n.h2,{id:"-introduction",children:"\ud83c\udf0d Introduction"}),"\n",(0,t.jsx)(n.p,{children:"Frigate NVR is an open-source Network Video Recorder (NVR) designed specifically for real-time object detection using AI models. It is lightweight, powerful, and works seamlessly with cameras via the RTSP protocol."}),"\n",(0,t.jsx)(n.p,{children:"Home Assistant (HA) is an open-source platform for smart home automation that enables you to control and automate devices in your home."}),"\n",(0,t.jsxs)(n.p,{children:["In this guide, we'll walk you through how to install ",(0,t.jsx)(n.strong,{children:"Frigate on a reComputer AI box"})," equipped with ",(0,t.jsx)(n.strong,{children:"Hailo PCIe"}),", and how to connect it to your existing ",(0,t.jsx)(n.strong,{children:"Home Assistant"})," setup using ",(0,t.jsx)(n.strong,{children:"MQTT"})," with minimal hassle."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-install-hailo-pcie-driver",children:"\ud83d\udee0\ufe0f Install Hailo PCIe Driver"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-enable-pcie-gen-3-mode",children:"Step 1: Enable PCIe Gen 3 Mode"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo raspi-config\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to ",(0,t.jsx)(n.code,{children:"6 Advanced Options > A8 PCIe Speed"})]}),"\n",(0,t.jsxs)(n.li,{children:["Select ",(0,t.jsx)(n.code,{children:"Yes"})," to enable PCIe Gen 3"]}),"\n",(0,t.jsxs)(n.li,{children:["Exit and select ",(0,t.jsx)(n.code,{children:"Finish"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"object detection",src:i(9850).Z+"",width:"1920",height:"1080"})}),"\n",(0,t.jsxs)(n.p,{children:["Append the following line to the end of ",(0,t.jsx)(n.code,{children:"/boot/firmware/config.txt"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"dtoverlay=pciex1-compat-pi5,no-mip\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-install-pcie-driver",children:"Step 2: Install PCIe Driver"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install dkms\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/hailo-ai/hailort-drivers\ncd hailort-drivers/linux/pcie\ngit checkout 24e7ff2fb58fab7029024c1a1d3f2d1914f56d7b\nsudo make install_dkms\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-3-install-firmware",children:"Step 3: Install Firmware"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ../..\n./download_firmware.sh\nsudo mkdir -p /lib/firmware/hailo\nsudo cp hailo8_fw*.bin /lib/firmware/hailo/hailo8_fw.bin\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-4-fix-pcie-descriptor-size-issue",children:"Step 4: Fix PCIe Descriptor Size Issue"}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"/etc/modprobe.d/hailo_pci.conf"})," with this content:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"options hailo_pci force_desc_page_size=4096\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-5-reboot-and-verify",children:"Step 5: Reboot and Verify"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo reboot\nls /dev/hailo*\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/dev/hailo0\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-install-frigate-nvr-with-docker",children:"\ud83d\udea7 Install Frigate NVR with Docker"}),"\n",(0,t.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Make sure your camera is configured for RTSP streaming at 1920x1080 resolution."}),"\n",(0,t.jsx)(n.h3,{id:"update-system",children:"Update System"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt update\n"})}),"\n",(0,t.jsx)(n.h3,{id:"install-docker",children:"Install Docker"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -fsSL get.docker.com | bash\nsudo usermod -aG docker $USER\nsudo reboot\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pull-frigate-image",children:"Pull Frigate Image"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/blakeblackshear/frigate:0.15.0-rc2-h8l\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-directory-structure",children:"Create Directory Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/frigate/config\nmkdir -p ~/frigate/data/db\nmkdir -p ~/frigate/data/storage\ncd ~/frigate\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-docker-compose-file-frigateyml",children:"Create Docker Compose File (frigate.yml)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nano frigate.yml\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"services:\n  frigate-hailo:\n    container_name: frigate-hailo\n    privileged: true\n    restart: unless-stopped\n    image: ghcr.io/blakeblackshear/frigate:0.15.0-rc2-h8l\n    shm_size: 1024mb\n    devices:\n      - /dev/hailo0:/dev/hailo0\n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n      - ./config/:/config\n      - ./data/db/:/data/db\n      - ./data/storage:/media/frigate\n      - type: tmpfs\n        target: /tmp/cache\n        tmpfs:\n          size: 1g\n    ports:\n      - 5000:5000\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-frigate-config-file-configconfigyml",children:"Create Frigate Config File (config/config.yml)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nano config/config.yml\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"database:\n  path: /data/db/frigate.db\n\ngo2rtc:\n  streams:\n    home:\n      - rtsp://admin:passw0rd@192.168.98.11:554/cam/realmonitor?channel=1&subtype=0\n\ncameras:\n  home:\n    ffmpeg:\n      inputs:\n        - path: rtsp://admin:passw0rd@192.168.98.11:554/cam/realmonitor?channel=1&subtype=0\n          roles:\n            - record\n            - detect\n\nmqtt:\n  enabled: False\n\nobjects:\n  track:\n    - person\n    - cat\n\ndetectors:\n  hailo8l:\n    type: hailo8l\n    device: PCIe\n\nmodel:\n  width: 300\n  height: 300\n  model_type: ssd\n  path: /config/model_cache/h8l_cache/ssd_mobilenet_v1.hef\n\nversion: 0.15-1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"start-frigate",children:"Start Frigate"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose -f frigate.yml up -d\n"})}),"\n",(0,t.jsx)(n.h3,{id:"access-web-ui",children:"Access Web UI"}),"\n",(0,t.jsxs)(n.p,{children:["Visit: ",(0,t.jsx)(n.code,{children:"http://<your-device-ip>:5000"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"frigate",src:i(5644).Z+"",width:"1104",height:"569"})}),"\n",(0,t.jsx)(n.h2,{id:"-home-assistant-integration",children:"\ud83c\udf1f Home Assistant Integration"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-hacs-setup",children:"Step 1: HACS Setup"}),"\n",(0,t.jsx)(n.p,{children:"Assuming you're running Home Assistant (HA Green, HA Yellow, or similar standalone devices):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Install ",(0,t.jsx)(n.a,{href:"https://hacs.xyz/docs/setup/download",children:"HACS"})," if not already installed."]}),"\n",(0,t.jsxs)(n.li,{children:["In HACS, install the ",(0,t.jsx)(n.strong,{children:"Frigate integration"})," from the community store."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"frigate",src:i(8013).Z+"",width:"1438",height:"753"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Configure it using the IP and port of your Frigate AI box, e.g.:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"http://<ai_box_ip>:5000\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"config_fri",src:i(5982).Z+"",width:"885",height:"1464"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-install-mqtt-add-on",children:"Step 2: Install MQTT Add-on"}),"\n",(0,t.jsxs)(n.p,{children:["Follow the ",(0,t.jsx)(n.a,{href:"https://www.home-assistant.io/integrations/mqtt/",children:"official MQTT integration guide"})," to install and configure the MQTT broker add-on."]}),"\n",(0,t.jsx)(n.h3,{id:"step-3-update-frigate-config-for-mqtt",children:"Step 3: Update Frigate Config for MQTT"}),"\n",(0,t.jsx)(n.h3,{id:"step-3-update-frigate-config-for-mqtt-1",children:"Step 3: Update Frigate Config for MQTT"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"mqtt:\n  host: <HA IP>\n  port: 1883\n  topic_prefix: frigate\n  client_id: frigate\n  user: <HA User Name>\n  password: <HA Password>\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"mqtt:\n  host: 10.0.0.136\n  port: 1883\n  topic_prefix: frigate\n  client_id: frigate\n  user: kasun\n  password: HiezenburgCook\n"})}),"\n",(0,t.jsx)(n.p,{children:"full example :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"database:\n  path: /data/db/frigate.db\n\ngo2rtc:\n  streams:\n    home:\n      - rtsp://admin:12345678a@10.0.0.108:554/cam/realmonitor?channel=1&subtype=0\n\ncameras:\n  home:\n    ffmpeg:\n      inputs:\n        - path: rtsp://admin:12345678a@10.0.0.108:554/cam/realmonitor?channel=1&subtype=0\n          roles:\n            - record\n            - detect\n\nmqtt:\n  host: core-mosquitto\n  port: 1883\n  topic_prefix: frigate\n  client_id: frigate\n  user: kasun\n  password: HiezenburgCook\n\nobjects:\n  track:\n    - person\n    - cat\n\ndetectors:\n  hailo8l:\n    type: hailo8l\n    device: PCIe\n\nmodel:\n  width: 300\n  height: 300\n  model_type: ssd\n  path: /config/model_cache/h8l_cache/ssd_mobilenet_v1.hef\n\nversion: 0.15-1\n\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-4-restart-frigate",children:"Step 4: Restart Frigate"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose -f frigate.yml down\nsudo docker compose -f frigate.yml up -d\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-5-confirm-mqtt-is-working-optional",children:"Step 5: Confirm MQTT is Working (optional)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check HA logs or MQTT add-on logs to verify messages from Frigate"}),"\n",(0,t.jsx)(n.li,{children:"In HA, you can now use Frigate events in automations, e.g., motion alerts, detected objects, etc."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"config_fri",src:i(9411).Z+"",width:"1730",height:"1854"})})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8013:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/HACS-bf5d6ee4b7e0131f64c56d20cf28f74b.png"},9411:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/HAinterface-f26f6de62f9b5ad1965db4bb172b4474.PNG"},5982:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/config_frigate-4b76a8679dfc6e8c9d31ec08a2c78edd.PNG"},5644:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/frigate_web-59887786352b5ac4b56c64e64a1d94bb.png"},9850:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/pcie-a0fcba12ac28a3e9b9c6dee8b88b25d7.png"},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>r});var t=i(7294);const a={},s=t.createContext(a);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);